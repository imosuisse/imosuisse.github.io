Let $D$ be the set of real numbers excluding $-1$.
Find all functions $f\colon D\rightarrow D$ such that
for all $x,y\in D$ satisfying $x\neq 0$ and $y\neq -x$, the equality
$$\Big(f(f(x))+y\Big)f\left(\frac{y}{x}\right)+f(f(y)) = x$$
holds.
