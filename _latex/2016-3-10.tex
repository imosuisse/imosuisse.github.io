Determine all functions $f\colon\mathbb{R}\to\mathbb{R}$ such that
\[
    f(x+yf(x+y))=y^2+f(xf(y+1))
\]
for all $x,y\in\mathbb{R}$.

