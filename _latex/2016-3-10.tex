Find all functions $f\colon\mathbb{R}\to\mathbb{R}$ such that for all $x,y\in\mathbb{R}$:
$$f(x+yf(x+y))=y^2+f(xf(y+1)).$$